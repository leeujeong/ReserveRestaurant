<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.reserve.restaurant.repository.AdminRepository">

	<resultMap type="Owner" id="OwnerMap">
		<result column="OWNER_NO" property="ownerNo" />
		<result column="ID" property="id" />
		<result column="PW" property="pw" />
		<result column="EMAIL" property="email" />
		<result column="TEL" property="tel" />
		<result column="NAME" property="name" />
		<result column="STATE" property="state" />
		<collection property="restaurant" resultMap="RestaurantMap" />
	</resultMap>
	<resultMap type="Restaurant" id="RestaurantMap">
		<result column="RES_NO" property="resNo" />
		<result column="RES_NAME" property="resName" />
		<result column="RES_ADDRESS" property="resAddress" />
		<result column="RES_ADDRESS_DETAIL" property="resAddressDetail" />
		<result column="RES_OPEN_TIME" property="resOpenTime" />
		<result column="RES_CLOSE_TIME" property="resCloseTime" />
		<result column="RES_TEL" property="resTel" />
		<result column="RES_CONTENT" property="resContent" />
		<result column="RES_OPTION" property="resOption" />
		<result column="RES_ORIGIN" property="resOrigin" />
		<result column="RES_SAVED" property="resSaved" />
		<result column="RES_PATH" property="resPath" />
		<result column="OWNER_NO" property="ownerNo" />
	</resultMap>













	<select id="countUser" resultType="int">
		SELECT COUNT(*)
		  FROM USERTABLE
		 WHERE STATE = 1
	</select>

	<select id="countOwner" resultType="int">
		SELECT COUNT(*)
		  FROM OWNER
	</select>
	
	<select id="selectUserList" parameterType="Map" resultType="User">
		SELECT B.USER_NO, B.ID, B.PW, B.NAME, B.TEL, B.GRADE, B.USER_DATE, B.HBD, B.STATE, B.POINT, B.EMAIL
		  FROM (SELECT ROWNUM AS RN, A.USER_NO, A.ID, A.PW, A.NAME, A.TEL, A.GRADE, A.USER_DATE, A.HBD, A.STATE, A.POINT, A.EMAIL
		   		  FROM (SELECT USER_NO, ID, PW, NAME, TEL, GRADE, USER_DATE, HBD, STATE, POINT, EMAIL
		   	       		  FROM USERTABLE
		   	       		 WHERE STATE = 1) A) B
		 WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	<select id="selectOwnerList" parameterType="Map" resultType="Owner">
		SELECT B.OWNER_NO, B.ID, B.PW, B.EMAIL, B.NAME, B.TEL, B.STATE
		  FROM (SELECT ROWNUM AS RN, A.OWNER_NO, A.ID, A.PW, A.EMAIL, A.NAME, A.TEL, A.STATE
		   		  FROM (SELECT OWNER_NO, ID, PW, EMAIL, NAME, TEL, STATE
		   	       		  FROM OWNER) A) B
		 WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	<!-- 검색된 목록 수 -->
	<select id="selectFindRecordCount" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		  FROM USERTABLE
		 WHERE 1 = 1 AND STATE = 1
		 	   <if test="column == 'ID'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
		       <if test="column == 'NAME'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
		       <if test="column == 'TEL'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	</select>
	
	<!-- 검색 목록을 반환시켜주는 select -->
	<select id="selectFindList" parameterType="Map" resultType="User">
		SELECT B.USER_NO, B.ID, B.PW, B.NAME, B.TEL, B.GRADE, B.USER_DATE, B.HBD, B.STATE, B.POINT, B.EMAIL
		  FROM (SELECT ROWNUM AS RN, A.USER_NO, A.ID, A.PW, A.NAME, A.TEL, A.GRADE, A.USER_DATE, A.HBD, A.STATE, A.POINT, A.EMAIL
		   		  FROM (SELECT USER_NO, ID, PW, NAME, TEL, GRADE, USER_DATE, HBD, STATE, POINT, EMAIL
		   	       		  FROM USERTABLE
	  			  		 WHERE 1 = 1 AND STATE = 1
	  			  		 	   <if test="column == 'ID'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	  			  		 	   <if test="column == 'NAME'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	  			  		 	   <if test="column == 'TEL'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>) A) B	  			  		 	   	  			  		 
	  	 WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	
	<select id="selectFindRecordCountOwner" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		  FROM OWNER
		 WHERE 1 = 1
		 	   <if test="column == 'ID'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
		       <if test="column == 'NAME'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
		       <if test="column == 'TEL'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	</select>
	
	<select id="selectFindListOwner" parameterType="Map" resultType="Owner">
		SELECT B.OWNER_NO, B.ID, B.PW, B.EMAIL, B.NAME, B.TEL, B.STATE
		  FROM (SELECT ROWNUM AS RN, A.OWNER_NO, A.ID, A.PW, A.EMAIL, A.NAME, A.TEL, A.STATE
		   		  FROM (SELECT OWNER_NO, ID, PW, EMAIL, NAME, TEL, STATE
		   	       		  FROM OWNER
	  			  		 WHERE 1 = 1
	  			  		 	   <if test="column == 'ID'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	  			  		 	   <if test="column == 'NAME'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>
	  			  		 	   <if test="column == 'TEL'">AND UPPER(${column}) LIKE '%' || UPPER(TRIM(#{query})) || '%'</if>) A) B	  			  		 	   	  			  		 
	  	 WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	<select id="selectUserInfo" parameterType="Long" resultType="User">
		SELECT USER_NO, ID, PW, NAME, TEL, GRADE, USER_DATE, HBD, STATE, POINT, EMAIL
		  FROM USERTABLE
		 WHERE USER_NO = #{userNo}
	</select>
	
	<select id="selectOwnerInfo" parameterType="Long" resultType="Owner">
		SELECT OWNER_NO, ID, NAME, EMAIL, TEL
		  FROM OWNER
		 WHERE OWNER_NO = #{owner_no}
	</select>
	
	<select id="selectOwnerInfoRes" parameterType="Long" resultType="Restaurant">
		SELECT RES_NAME, RES_ADDRESS, RES_ADDRESS_DETAIL, RES_OPEN_TIME, RES_CLOSE_TIME, RES_TEL, RES_OPTION
		  FROM RESTAURANT
		 WHERE OWNER_NO = #{owner_no}
	</select>

	<select id="searchCountRes" parameterType="String" resultType="int">
		SELECT COUNT(*)
		  FROM RESTAURANT
		 WHERE RES_ADDRESS LIKE '%' || TRIM(#{query}) || '%'
		    OR RES_ADDRESS_DETAIL LIKE '%' || TRIM(#{query}) || '%'
		    OR RES_NAME LIKE '%' || TRIM(#{query}) || '%'
	</select>

	
	<select id="resListByAddress" parameterType="Map" resultType="Restaurant">
		 SELECT B.RES_NO, B.RES_NAME, B.RES_ADDRESS, B.RES_ADDRESS_DETAIL, B.RES_OPEN_TIME, B.RES_CLOSE_TIME, B.RES_TEL, B.RES_OPTION
		   FROM (SELECT ROWNUM AS RN, A.RES_NO, A.RES_NAME, A.RES_ADDRESS, A.RES_ADDRESS_DETAIL, A.RES_OPEN_TIME, A.RES_CLOSE_TIME, A.RES_TEL, A.RES_OPTION
		           FROM (SELECT RES_NO, RES_NAME, RES_ADDRESS, RES_ADDRESS_DETAIL, RES_OPEN_TIME, RES_CLOSE_TIME, RES_TEL, RES_OPTION
		           		   FROM RESTAURANT
		  		   		  WHERE RES_ADDRESS LIKE '%' || TRIM(#{query}) || '%'
		     		  	     OR RES_ADDRESS_DETAIL LIKE '%' || TRIM(#{query}) || '%'
		     		  		 OR RES_NAME LIKE '%' || TRIM(#{query}) || '%') A) B
		  WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	<select id="selectResDetail" parameterType="Long" resultType="Restaurant">
		SELECT RES_NO, RES_NAME, RES_ADDRESS, RES_ADDRESS_DETAIL, RES_OPEN_TIME, RES_CLOSE_TIME, RES_TEL, RES_CONTENT, RES_OPTION, RES_ORIGIN, RES_SAVED, RES_PATH, OWNER_NO
		  FROM RESTAURANT
		 WHERE RES_NO = #{resNo}
	</select>
	
	
	
</mapper>